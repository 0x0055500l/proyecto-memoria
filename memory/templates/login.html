{% extends 'base.html' %}
{% load static %}
{% block content %}
    <div class="logo-memory-container mb-4">
        <div class="logo-card card-1"><i class="bi bi-question-lg"></i></div>
        <div class="logo-card card-2"><i class="bi bi-controller"></i></div>
        <div class="logo-card card-3"><i class="bi bi-lightning-fill"></i></div>
        <div class="logo-card card-4"><i class="bi bi-star-fill"></i></div>
    </div>

    <h2 class="form-title">ðŸ§  Iniciar SesiÃ³n</h2>

    <!-- --- MENSAJE DE BLOQUEO --- -->
    {% if is_locked_out %}
        <div class="alert alert-danger" role="alert">
            <h5 class="alert-heading"><i class="bi bi-stopwatch-fill"></i> Â¡Bloqueado!</h5>
            Has superado el lÃ­mite de 3 intentos fallidos.
            Por favor, espera **1 minuto** antes de intentarlo de nuevo.
        </div>
    {% endif %}

    <!-- Mostramos errores de login (ej. "ContraseÃ±a incorrecta")
         SOLO si NO estamos bloqueados -->
    {% if form.errors and not is_locked_out %}
        <div class="alert alert-danger p-2">
            {% for error in form.non_field_errors %}
                {{ error }}
            {% endfor %}
        </div>
    {% endif %}

    <!-- Desactivamos el formulario si el usuario estÃ¡ bloqueado sino proseguir-->
    <form method="post">
        {% csrf_token %}
        <fieldset {% if is_locked_out %}disabled{% endif %}>
            {% for field in form %}
                <div class="mb-3">
                    <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                    {{ field }}
                    {% if field.help_text %}<small class="form-text text-muted">{{ field.help_text|safe }}</small>{% endif %}
                    {% for error in field.errors %}<div class="alert alert-danger p-1 mt-1">{{ error }}</div>{% endfor %}
                </div>
            {% endfor %}
            <button type="submit" class="btn btn-primary w-100 btn-game mt-3">
                <i class="bi bi-box-arrow-in-right"></i> Â¡A Jugar!
            </button>
        </fieldset>
    </form>
    <p class="mt-3 text-center small"><a href="{% url 'password_reset' %}" class="link-text">Â¿Olvidaste tu contraseÃ±a?</a></p>
    <p class="mt-4 text-center">Â¿Eres nuevo? <a href="{% url 'register' %}" class="link-text">Crea una cuenta</a></p>
{% endblock %}
